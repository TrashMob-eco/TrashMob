<?xml version="1.0" encoding="utf-8"?>

<createEvent:BaseStepClass xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                           xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                           xmlns:maps="http://schemas.microsoft.com/dotnet/2021/maui/maps"
                           xmlns:viewModels="clr-namespace:TrashMobMobile.ViewModels"
                           xmlns:createEvent="clr-namespace:TrashMobMobile.Pages.CreateEvent"
                           x:DataType="viewModels:CreateEventViewModel"
                           xmlns:controls="clr-namespace:TrashMobMobile.Controls"
                           x:Class="TrashMobMobile.Pages.CreateEvent.Step2">
    <ScrollView>
        <VerticalStackLayout Spacing="0" Padding="0,4">

            <!-- Instruction -->
            <Border Style="{StaticResource RoundBorder}" Margin="4,4"
                    BackgroundColor="{AppThemeBinding Light=#EEF7F5, Dark=#1A2F2C}">
                <HorizontalStackLayout Spacing="10">
                    <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                        <Image.Source>
                            <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                             Glyph="{StaticResource IconInformationOutline}"
                                             Size="20"
                                             Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                        </Image.Source>
                    </Image>
                    <Label Text="Tap on the map to set the event location."
                           FontSize="Small"
                           VerticalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                </HorizontalStackLayout>
            </Border>

            <!-- Map -->
            <Border StrokeShape="RoundRectangle 10"
                    StrokeThickness="0"
                    Padding="0"
                    Margin="4,4">
                <controls:CustomMap x:Name="eventLocationMap"
                                    ItemsSource="{Binding Events}"
                                    HeightRequest="320"
                                    MapClicked="OnMapClicked">
                    <maps:Map.ItemTemplate>
                        <DataTemplate x:DataType="viewModels:EventViewModel">
                            <controls:CustomPin Address="{Binding Address.StreetAddress}"
                                                Label="{Binding Name}"
                                                ImageSource="{Binding Address.IconFile}"
                                                Location="{Binding Address.Location}" />
                        </DataTemplate>
                    </maps:Map.ItemTemplate>
                </controls:CustomMap>
            </Border>

            <!-- Address Details Card -->
            <Border Style="{StaticResource RoundBorder}" Margin="4,4">
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout Spacing="8">
                        <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                            <Image.Source>
                                <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                 Glyph="{StaticResource IconMapMarkerOutline}"
                                                 Size="20"
                                                 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                            </Image.Source>
                        </Image>
                        <Label Text="Location Details"
                               FontFamily="LexendSemibold"
                               FontSize="Small"
                               VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <!-- Street Address -->
                    <VerticalStackLayout Spacing="2">
                        <Label Text="Street Address" Style="{StaticResource FieldLabel}"
                               TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                        <Label Text="{Binding EventViewModel.Address.StreetAddress}" FontSize="Small" />
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="*, *" ColumnSpacing="12" RowDefinitions="Auto, Auto" RowSpacing="10">
                        <!-- City -->
                        <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="2">
                            <Label Text="City" Style="{StaticResource FieldLabel}"
                                   TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                            <Label Text="{Binding EventViewModel.Address.City}" FontSize="Small" />
                        </VerticalStackLayout>

                        <!-- State/Region -->
                        <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="2">
                            <Label Text="State/Region" Style="{StaticResource FieldLabel}"
                                   TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                            <Label Text="{Binding EventViewModel.Address.Region}" FontSize="Small" />
                        </VerticalStackLayout>

                        <!-- Country -->
                        <VerticalStackLayout Grid.Row="1" Grid.Column="0" Spacing="2">
                            <Label Text="Country" Style="{StaticResource FieldLabel}"
                                   TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                            <Label Text="{Binding EventViewModel.Address.Country}" FontSize="Small" />
                        </VerticalStackLayout>

                        <!-- Postal Code -->
                        <VerticalStackLayout Grid.Row="1" Grid.Column="1" Spacing="2">
                            <Label Text="Postal Code" Style="{StaticResource FieldLabel}"
                                   TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                            <Label Text="{Binding EventViewModel.Address.PostalCode}" FontSize="Small" />
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <BoxView HeightRequest="12" BackgroundColor="Transparent" />

        </VerticalStackLayout>
    </ScrollView>
</createEvent:BaseStepClass>