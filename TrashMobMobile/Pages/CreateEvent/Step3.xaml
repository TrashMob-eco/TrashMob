<?xml version="1.0" encoding="utf-8"?>

<createEvent:BaseStepClass xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                           xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                           xmlns:createEvent="clr-namespace:TrashMobMobile.Pages.CreateEvent"
                           xmlns:maps="http://schemas.microsoft.com/dotnet/2021/maui/maps"
                           xmlns:viewModels="clr-namespace:TrashMobMobile.ViewModels"
                           x:DataType="viewModels:CreateEventViewModel"
                           xmlns:controls="clr-namespace:TrashMobMobile.Controls"
                           x:Class="TrashMobMobile.Pages.CreateEvent.Step3">
    <ScrollView>
        <Grid>
            <VerticalStackLayout Spacing="0" Padding="0,4">

                <!-- Event Name Header -->
                <Label Text="{Binding EventViewModel.Name}"
                       FontFamily="LexendSemibold"
                       FontSize="Large"
                       Margin="8,4,8,0"
                       LineBreakMode="WordWrap" />

                <!-- Event Details Card -->
                <Border Style="{StaticResource RoundBorder}" Margin="4,8,4,4">
                    <VerticalStackLayout Spacing="8">
                        <HorizontalStackLayout Spacing="8">
                            <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                                <Image.Source>
                                    <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                     Glyph="{StaticResource IconCalendarCheck}"
                                                     Size="20"
                                                     Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                                </Image.Source>
                            </Image>
                            <Label Text="Event Details"
                                   FontFamily="LexendSemibold"
                                   FontSize="Small"
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>

                        <!-- Event Type -->
                        <Label Text="{Binding SelectedEventType}"
                               FontSize="Small"
                               TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />

                        <!-- Date -->
                        <Label Text="{Binding EventViewModel.DisplayDate}"
                               FontFamily="LexendSemibold"
                               FontSize="Small" />

                        <!-- Time & Duration -->
                        <Grid ColumnDefinitions="*, *" ColumnSpacing="8">
                            <VerticalStackLayout Grid.Column="0" Spacing="2">
                                <Label Text="Time" Style="{StaticResource FieldLabel}"
                                       TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                                <Label Text="{Binding EventViewModel.DisplayTime}" FontSize="Small" />
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="2">
                                <Label Text="Duration" Style="{StaticResource FieldLabel}"
                                       TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                                <Label Text="{Binding EventViewModel.DisplayDuration}" FontSize="Small" />
                            </VerticalStackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Location Card -->
                <Border Style="{StaticResource RoundBorder}" Margin="4,4">
                    <VerticalStackLayout Spacing="8">
                        <HorizontalStackLayout Spacing="8">
                            <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                                <Image.Source>
                                    <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                     Glyph="{StaticResource IconMapMarkerOutline}"
                                                     Size="20"
                                                     Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                                </Image.Source>
                            </Image>
                            <Label Text="Location"
                                   FontFamily="LexendSemibold"
                                   FontSize="Small"
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>

                        <Label Text="{Binding EventViewModel.Address.DisplayAddress}"
                               FontSize="Small"
                               LineBreakMode="WordWrap" />

                        <!-- Map -->
                        <Border StrokeShape="RoundRectangle 10"
                                StrokeThickness="0"
                                Padding="0">
                            <controls:CustomMap x:Name="eventLocationMap"
                                                ItemsSource="{Binding Events}"
                                                HeightRequest="200">
                                <maps:Map.ItemTemplate>
                                    <DataTemplate x:DataType="viewModels:EventViewModel">
                                        <controls:CustomPin Location="{Binding Address.Location}"
                                                            Address="{Binding Address.StreetAddress}"
                                                            ImageSource="{Binding Address.IconFile}"
                                                            Label="{Binding Name}" />
                                    </DataTemplate>
                                </maps:Map.ItemTemplate>
                            </controls:CustomMap>
                        </Border>
                    </VerticalStackLayout>
                </Border>

                <!-- Description Card -->
                <Border Style="{StaticResource RoundBorder}" Margin="4,4">
                    <VerticalStackLayout Spacing="8">
                        <HorizontalStackLayout Spacing="8">
                            <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                                <Image.Source>
                                    <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                     Glyph="{StaticResource IconFileDocument}"
                                                     Size="20"
                                                     Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                                </Image.Source>
                            </Image>
                            <Label Text="About This Event"
                                   FontFamily="LexendSemibold"
                                   FontSize="Small"
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>

                        <Label Text="{Binding EventViewModel.Description}"
                               FontSize="Small"
                               LineBreakMode="WordWrap"
                               TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                    </VerticalStackLayout>
                </Border>

                <BoxView HeightRequest="12" BackgroundColor="Transparent" />

            </VerticalStackLayout>
            <BoxView BackgroundColor="{StaticResource TransparentBlack}" HorizontalOptions="Fill"
                     VerticalOptions="Fill" IsVisible="{Binding IsBusy}" />
            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" VerticalOptions="Center"
                               HorizontalOptions="Center" />
        </Grid>
    </ScrollView>
</createEvent:BaseStepClass>