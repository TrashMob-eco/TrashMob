<?xml version="1.0" encoding="utf-8"?>

<createEvent:BaseStepClass  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                            xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                            xmlns:createEvent="clr-namespace:TrashMobMobile.Pages.CreateEvent"
                            xmlns:viewModels="clr-namespace:TrashMobMobile.ViewModels"
                            x:Class="TrashMobMobile.Pages.CreateEvent.Step4">
    <ScrollView>
        <Grid>
            <VerticalStackLayout Spacing="0" Padding="0,4">

                <!-- No Partners Empty State -->
                <Border Style="{StaticResource RoundBorder}" Margin="4,4"
                        IsVisible="{Binding AreNoPartnersAvailable}">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center" Padding="0,20">
                        <Image MaximumWidthRequest="48" MaximumHeightRequest="48" HorizontalOptions="Center">
                            <Image.Source>
                                <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                 Glyph="{StaticResource IconHandshake}"
                                                 Size="48"
                                                 Color="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                            </Image.Source>
                        </Image>
                        <Label Text="No Partners Available"
                               FontFamily="LexendSemibold"
                               FontSize="Small"
                               HorizontalTextAlignment="Center"
                               TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                        <Label Text="There are currently no partners available in your area."
                               FontSize="Micro"
                               HorizontalTextAlignment="Center"
                               TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                    </VerticalStackLayout>
                </Border>

                <!-- Header with instruction -->
                <VerticalStackLayout Spacing="4" Margin="12,8,12,4"
                                     IsVisible="{Binding ArePartnersAvailable}">
                    <HorizontalStackLayout Spacing="8">
                        <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                            <Image.Source>
                                <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                 Glyph="{StaticResource IconHandshake}"
                                                 Size="20"
                                                 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                            </Image.Source>
                        </Image>
                        <Label Text="Available Event Partners"
                               FontFamily="LexendSemibold"
                               FontSize="Medium"
                               VerticalOptions="Center" />
                    </HorizontalStackLayout>
                    <Label Text="Tap a partner to request services for your event."
                           FontSize="Micro"
                           Margin="28,0,0,0"
                           TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                </VerticalStackLayout>

                <!-- Partner List -->
                <CollectionView x:Name="AvailableEventPartners"
                                ItemsSource="{Binding AvailablePartners}"
                                SelectedItem="{Binding SelectedEventPartnerLocation}"
                                SelectionMode="Single"
                                IsVisible="{Binding ArePartnersAvailable}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewModels:EventPartnerLocationViewModel">
                            <Border Style="{StaticResource RoundBorder}" Margin="4,4">
                                <VerticalStackLayout Spacing="8">
                                    <!-- Partner Name as header -->
                                    <Label Text="{Binding PartnerLocationName}"
                                           FontFamily="LexendSemibold"
                                           FontSize="Small"
                                           LineBreakMode="WordWrap" />

                                    <!-- Info -->
                                    <VerticalStackLayout Spacing="2">
                                        <Label Text="Info" Style="{StaticResource FieldLabel}"
                                               TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                                        <Label Text="{Binding PartnerLocationNotes}"
                                               FontSize="Micro"
                                               LineBreakMode="WordWrap" />
                                    </VerticalStackLayout>

                                    <!-- Services Requested -->
                                    <VerticalStackLayout Spacing="2">
                                        <Label Text="Services Requested" Style="{StaticResource FieldLabel}"
                                               TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                                        <Label Text="{Binding PartnerServicesEngaged}"
                                               FontSize="Micro"
                                               LineBreakMode="WordWrap" />
                                    </VerticalStackLayout>
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <BoxView HeightRequest="12" BackgroundColor="Transparent" />

            </VerticalStackLayout>
            <BoxView BackgroundColor="{StaticResource TransparentBlack}" HorizontalOptions="Fill"
                     VerticalOptions="Fill" IsVisible="{Binding IsBusy}" />
            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" VerticalOptions="Center"
                               HorizontalOptions="Center" />
        </Grid>
    </ScrollView>
</createEvent:BaseStepClass>