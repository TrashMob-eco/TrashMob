<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:maps="http://schemas.microsoft.com/dotnet/2021/maui/maps"
             xmlns:viewModels="clr-namespace:TrashMobMobile.ViewModels"
             xmlns:controls="clr-namespace:TrashMobMobile.Controls"
             x:Class="TrashMobMobile.Views.ViewEvent.TabDetails">
    <ScrollView>
        <VerticalStackLayout Spacing="12" Margin="0">

            <!-- Map -->
            <Border StrokeShape="RoundRectangle 10"
                    StrokeThickness="0"
                    Padding="0"
                    Margin="5,0">
                <controls:CustomMap x:Name="eventLocationMap" HeightRequest="200"
                                    HandlerProperties.DisconnectPolicy="Manual"
                                    ItemsSource="{Binding Addresses}">
                    <maps:Map.ItemTemplate>
                        <DataTemplate x:DataType="viewModels:AddressViewModel">
                            <controls:CustomPin Location="{Binding Location}"
                                                Address="{Binding StreetAddress}"
                                                ImageSource="{Binding IconFile}"
                                                Label="{Binding AddressType}" />
                        </DataTemplate>
                    </maps:Map.ItemTemplate>
                </controls:CustomMap>
            </Border>

            <!-- Event Info Card -->
            <Border Style="{x:StaticResource RoundBorder}">
                <VerticalStackLayout Spacing="10">

                    <!-- Date & Time -->
                    <HorizontalStackLayout Spacing="10">
                        <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Start">
                            <Image.Source>
                                <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                 Glyph="{StaticResource IconCalendarCheck}"
                                                 Size="20"
                                                 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                            </Image.Source>
                        </Image>
                        <VerticalStackLayout Spacing="2">
                            <Label Text="{Binding EventViewModel.DisplayDate}"
                                   FontFamily="LexendSemibold"
                                   FontSize="Small" />
                            <Label Text="{Binding EventViewModel.DisplayTime}"
                                   FontSize="Micro"
                                   TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                    <!-- Duration -->
                    <HorizontalStackLayout Spacing="10">
                        <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                            <Image.Source>
                                <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                 Glyph="{StaticResource IconTimerOutline}"
                                                 Size="20"
                                                 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                            </Image.Source>
                        </Image>
                        <Label Text="{Binding DisplayDuration}"
                               FontSize="Small"
                               VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <!-- Address -->
                    <HorizontalStackLayout Spacing="10">
                        <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Start">
                            <Image.Source>
                                <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                 Glyph="{StaticResource IconMapMarkerOutline}"
                                                 Size="20"
                                                 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                            </Image.Source>
                        </Image>
                        <Label Text="{Binding EventViewModel.Address.DisplayAddress}"
                               FontSize="Small"
                               VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <!-- Event Type -->
                    <HorizontalStackLayout Spacing="10">
                        <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                            <Image.Source>
                                <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                 Glyph="{StaticResource IconTag}"
                                                 Size="20"
                                                 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                            </Image.Source>
                        </Image>
                        <Label Text="{Binding SelectedEventType}"
                               FontSize="Small"
                               VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <!-- Visibility -->
                    <HorizontalStackLayout Spacing="10">
                        <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                            <Image.Source>
                                <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                 Glyph="{StaticResource IconEye}"
                                                 Size="20"
                                                 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                            </Image.Source>
                        </Image>
                        <Label Text="{Binding EventViewModel.EventVisibilityText}"
                               FontSize="Small"
                               VerticalOptions="Center" />
                    </HorizontalStackLayout>

                </VerticalStackLayout>
            </Border>

            <!-- About This Event Card -->
            <Border Style="{x:StaticResource RoundBorder}">
                <VerticalStackLayout Spacing="8">
                    <HorizontalStackLayout Spacing="8">
                        <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                            <Image.Source>
                                <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                 Glyph="{StaticResource IconInformationOutline}"
                                                 Size="20"
                                                 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                            </Image.Source>
                        </Image>
                        <Label Text="About this event"
                               FontFamily="LexendSemibold"
                               FontSize="Small" />
                    </HorizontalStackLayout>
                    <Label Text="{Binding EventViewModel.Description}"
                           FontSize="Micro"
                           TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                    <Label Text="{Binding WhatToExpect}"
                           FontSize="Micro"
                           TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                </VerticalStackLayout>
            </Border>

            <!-- Attendees -->
            <HorizontalStackLayout Spacing="8" Margin="5,4">
                <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                    <Image.Source>
                        <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                         Glyph="{StaticResource IconAccount}"
                                         Size="20"
                                         Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                    </Image.Source>
                </Image>
                <Label Text="{Binding AttendeeCount}"
                       FontSize="Small"
                       VerticalOptions="Center" />
            </HorizontalStackLayout>

            <!-- Primary Actions -->
            <Button Text="Register"
                    Command="{Binding RegisterCommand}"
                    IsVisible="{Binding EnableRegister}"
                    HorizontalOptions="Fill"
                    Margin="5,4" />
            <Button Text="Unregister"
                    Command="{Binding UnregisterCommand}"
                    IsVisible="{Binding EnableUnregister}"
                    Style="{StaticResource SecondarySmallButton}"
                    HorizontalOptions="Fill"
                    Margin="5,4" />
            <Button Text="Edit Event"
                    Command="{Binding EditEventCommand}"
                    IsVisible="{Binding EnableEditEvent}"
                    Style="{StaticResource SecondarySmallButton}"
                    HorizontalOptions="Fill"
                    Margin="5,4" />

            <!-- Secondary Actions -->
            <Button Text="View Event Summary"
                    Command="{Binding ViewEventSummaryCommand}"
                    IsVisible="{Binding EnableViewEventSummary}"
                    Style="{StaticResource SecondarySmallButton}"
                    Margin="5,4" />

            <!-- Log My Impact Button -->
            <Button Text="Log My Impact"
                    Command="{Binding LogImpactCommand}"
                    IsVisible="{Binding ShowLogImpactButton}"
                    HorizontalOptions="Fill"
                    Margin="5,4" />

            <!-- My Contribution Card -->
            <Border Style="{x:StaticResource RoundBorder}"
                    IsVisible="{Binding ShowMyContribution}">
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout Spacing="8">
                        <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                            <Image.Source>
                                <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                 Glyph="{StaticResource IconChartBox}"
                                                 Size="20"
                                                 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                            </Image.Source>
                        </Image>
                        <Label Text="My Contribution"
                               FontFamily="LexendSemibold"
                               FontSize="Small" />
                        <Border Padding="6,2"
                                StrokeShape="RoundRectangle 8"
                                StrokeThickness="0"
                                BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                HorizontalOptions="EndAndExpand">
                            <Label Text="{Binding MyMetricsStatus}"
                                   FontSize="Micro"
                                   TextColor="White" />
                        </Border>
                    </HorizontalStackLayout>

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                        <VerticalStackLayout Grid.Column="0" HorizontalOptions="Center">
                            <Label Text="{Binding MyBagsCollected}"
                                   FontFamily="LexendSemibold"
                                   FontSize="Medium"
                                   HorizontalTextAlignment="Center" />
                            <Label Text="Bags"
                                   FontSize="Micro"
                                   HorizontalTextAlignment="Center"
                                   TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1" HorizontalOptions="Center">
                            <Label Text="{Binding MyWeightDisplay}"
                                   FontFamily="LexendSemibold"
                                   FontSize="Medium"
                                   HorizontalTextAlignment="Center" />
                            <Label Text="Weight"
                                   FontSize="Micro"
                                   HorizontalTextAlignment="Center"
                                   TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="2" HorizontalOptions="Center">
                            <Label Text="{Binding MyDurationMinutes, StringFormat='{0} min'}"
                                   FontFamily="LexendSemibold"
                                   FontSize="Medium"
                                   HorizontalTextAlignment="Center" />
                            <Label Text="Duration"
                                   FontSize="Micro"
                                   HorizontalTextAlignment="Center"
                                   TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                        </VerticalStackLayout>
                    </Grid>

                    <Button Text="Update My Impact"
                            Command="{Binding LogImpactCommand}"
                            Style="{StaticResource SecondarySmallButton}"
                            HorizontalOptions="Fill" />
                </VerticalStackLayout>
            </Border>

            <!-- Lead Metrics Actions -->
            <Border Style="{x:StaticResource RoundBorder}"
                    IsVisible="{Binding ShowLeadMetricsActions}">
                <VerticalStackLayout Spacing="8">
                    <HorizontalStackLayout Spacing="8">
                        <Image MaximumWidthRequest="20" MaximumHeightRequest="20" VerticalOptions="Center">
                            <Image.Source>
                                <FontImageSource FontFamily="{StaticResource GoogleMaterialIcons}"
                                                 Glyph="{StaticResource IconClipboardCheck}"
                                                 Size="20"
                                                 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                            </Image.Source>
                        </Image>
                        <Label Text="Attendee Metrics"
                               FontFamily="LexendSemibold"
                               FontSize="Small" />
                    </HorizontalStackLayout>
                    <Label Text="{Binding PendingMetricsCount, StringFormat='{0} submission(s) pending review'}"
                           FontSize="Micro"
                           TextColor="{AppThemeBinding Light={StaticResource MutedForegroundLight}, Dark={StaticResource MutedForegroundDark}}" />
                    <Button Text="Approve All"
                            Command="{Binding ApproveAllMetricsCommand}"
                            Style="{StaticResource SecondarySmallButton}"
                            HorizontalOptions="Fill" />
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>
</ContentView>
